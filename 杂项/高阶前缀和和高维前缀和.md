### 高阶前缀和

之前学了树状数组维护高阶的前缀和，比较适合二三阶的，再高阶式子要推麻了

然后最近发现，居然可以 $O(nlogn)$​ 地求一个数组的任意阶前缀和

假设数组原本是$[1,1,1,1,1,1]$​

尝试写出它的各阶前缀和：
$$
[1,2,3,4,5]\\
[1,3,6,10,15]\\
[1,4,10,20,35]
$$
把这看成一个矩阵，往下继续写，可以很明显得出：$sum[i][j] = sum[i-1][j]+sum[i][j-1]$

这个式子很熟悉，杨辉三角，组合数，左下走到右下的方案数等都是这个东西（斜着看）

显然这个矩阵可以预处理出来或者很快地求，$sum[i][j] = C_{i+j-1}^{j-1}$

那如何计算一个数组 $a=[a_1,a_2,..a_n]$​ 的 $k$​ 阶前缀和呢（矩阵中第 $k$ 行）？

答案很简单：计算数组 $a$​​​​ 和上面第 $k-1$​​​ 行的卷积，就是 $a$​​​  数组的 $k$​​​​ 阶的前缀和

以求二阶行前缀和为例，结果就是 $a$ 与 $[1,2,3,4,5]$ 的卷积，那么其中第三项等于：
$$
sum[3] = a_1\times3 + a_2\times2 + a_3\times1
$$
感受一下，每一行的第 $i$ 个数对下一行第 $i$​ 个及其之后的数有贡献，这其实本质是一个卷积

例题：https://ac.nowcoder.com/acm/contest/19483/C

##### 直接从多项式角度理解：

原数组做一次前缀和，其实相当于和一个全是1的数组做一次卷积（取前 $n$ 项）

也可以看成和多项式 $1+x+x^2+..x^n$ 相乘，而卷积具有结合律，故可以看成这个多项式先自己卷 $k-1$ 次，最后再和原数组卷一次

差分也同理，可以看做和多项式 $1-x$ 相乘。

例题：https://www.luogu.com.cn/problem/P5488



### 高维前缀和

以二维数组的前缀和为例：

要计算 $sum[i][j]$​，一般会想到容斥：$sum[i][j] = sum[i-1][j] +sum[i][j-1] - sum[i-1][j-1]+a[i][j]$​

然而这个东西，在维数变大时，容斥计算的次数会成指数级增长，应对不了高维的前缀和

有另一种同样简单的搞法：

- 先计算列上的前缀和：$sum[i][j] = sum[i-1][j] +a[i][j]$
- 然后再计算行上的前缀和：$sum[i][j]= sum[i][j] + sum[i][j-1]$​

简单画个图理解下就可以了，那么对于 $k$ 维数组求前缀和：

- 首先初始化 $sum[i][j][..][k]=a[i][j][...][k]$​
- 然后对每一维求一遍前缀和，顺序无所谓

搞定



### SOSDP

Sum of Subset DP 子集前缀和

例题：https://ac.nowcoder.com/acm/contest/19483/B

给 $n$ 个物品，每个物品有权值 $a_i$，定义一个物品集的权值为所有权值异或和，有 $m$​ 次询问，每次选出一些物品，求他们的所有子集的权值之和（$n \le 20$）

从两个物品的情况考虑，画一个图：
$$
[0,A]\\
[B,AxorB]
$$
[0,1]表示只选A不选B， [1,1] 位置表示两个都选

像这样构建初始值，再做一次二维的前缀和，[1,1]位置就得到2个物品所有子集的权值和了，为$A+B+AxorB$

同理，有k个物品时，我们也可以开一个k维数组，设置好初始值例如 f[][][][][1,1,1,0] 表示选择前三个，不选最后一个物品的权值，然后做一遍k维前缀和，然后就可以任意查询了！

比如要查询 1,2,5,6 这几个物品，那就直接输出 f[1,1,0,0,1,1] 即可，意味着仅对这几个维度做前缀和，不选的维度保持0的结果。



再来一个问题：同样的询问，问这些物品的所有超集权值之和

也是同样的搞法，前缀和改成后缀和即可

理解一下，取前缀和意味着最多取这几个的所有情况，后缀和意味着最少取这几个的所有情况